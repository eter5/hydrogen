"use strict";(self.webpackChunkdocs_v_1=self.webpackChunkdocs_v_1||[]).push([[6850],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},s=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),c=p(n),h=r,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||o;return n?i.createElement(m,a(a({ref:t},s),{},{components:n})):i.createElement(m,a({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=h;var d={};for(var l in t)hasOwnProperty.call(t,l)&&(d[l]=t[l]);d.originalType=e,d[c]="string"==typeof e?e:r,a[1]=d;for(var p=2;p<o;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5035:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>p});var i=n(7462),r=(n(7294),n(3905));const o={},a="Third-party dependencies",d={unversionedId:"tutorials/third-party-dependencies",id:"tutorials/third-party-dependencies",title:"Third-party dependencies",description:"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please migrate to Hydrogen 2.0 as soon as possible.",source:"@site/docs/tutorials/third-party-dependencies.md",sourceDirName:"tutorials",slug:"/tutorials/third-party-dependencies",permalink:"/hydrogen-v1/tutorials/third-party-dependencies",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"hydrogen",previous:{title:"Streaming server-side rendering (SSR)",permalink:"/hydrogen-v1/tutorials/streaming-ssr"},next:{title:"API reference",permalink:"/hydrogen-v1/api"}},l={},p=[{value:"Installation",id:"installation",level:2},{value:"Where to insert dependencies",id:"where-to-insert-dependencies",level:2},{value:"Troubleshooting dependencies",id:"troubleshooting-dependencies",level:2},{value:"Updating Vite dependencies",id:"updating-vite-dependencies",level:3},{value:"Bundling third-party dependencies",id:"bundling-third-party-dependencies",level:3},{value:"Next steps",id:"next-steps",level:2}],s={toc:p},c="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,i.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"third-party-dependencies"},"Third-party dependencies"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please ",(0,r.kt)("a",{parentName:"p",href:"https://shopify.dev/docs/custom-storefronts/hydrogen/migrate-hydrogen-remix"},"migrate to Hydrogen 2.0")," as soon as possible.")),(0,r.kt)("p",null,"Third-party dependencies will generally work out-of-the-box with Hydrogen. This guide describes how to install third-party dependencies, where to insert them, and offers tips for troubleshooting dependencies."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"To install third party dependencies, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash?title:",metastring:"'npm'","'npm'":!0},"\nnpm install <dependency>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash?title:",metastring:"'Yarn'","'Yarn'":!0},"yarn add <dependency>\n")),(0,r.kt)("h2",{id:"where-to-insert-dependencies"},"Where to insert dependencies"),(0,r.kt)("p",null,"Consider the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the dependency interacts with ",(0,r.kt)("inlineCode",{parentName:"li"},"useState")," or browser APIs, then place it inside a ",(0,r.kt)("inlineCode",{parentName:"li"},"*.client.jsx")," component. Follow the ",(0,r.kt)("a",{parentName:"li",href:"/hydrogen-v1/tutorials/react-server-components/#constraints"},"rules of server and client components"),"."),(0,r.kt)("li",{parentName:"ul"},"If the dependency is purely client-based, and you don't need to interact with it in individual components, then you can insert it in the ",(0,r.kt)("inlineCode",{parentName:"li"},"<head>")," element of ",(0,r.kt)("inlineCode",{parentName:"li"},"index.html"),"."),(0,r.kt)("li",{parentName:"ul"},"If the dependency includes a style import from a CSS file, then you can import that in the ",(0,r.kt)("inlineCode",{parentName:"li"},"<head>")," element of ",(0,r.kt)("inlineCode",{parentName:"li"},"index.html"),".")),(0,r.kt)("h2",{id:"troubleshooting-dependencies"},"Troubleshooting dependencies"),(0,r.kt)("p",null,"This section provides strategies for troubleshooting third-party dependencies in your Hydrogen project."),(0,r.kt)("h3",{id:"updating-vite-dependencies"},"Updating Vite dependencies"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://vitejs.dev/"},"Vite")," caches pre-bundled dependencies in ",(0,r.kt)("inlineCode",{parentName:"p"},"node_modules/.vite"),". It re-runs the pre-bundling step if any of the following changes occur:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The dependencies list is updated in ",(0,r.kt)("inlineCode",{parentName:"li"},"package.json")),(0,r.kt)("li",{parentName:"ul"},"Package manager lockfiles (for example ",(0,r.kt)("inlineCode",{parentName:"li"},"yarn.lock"),") are updated"),(0,r.kt)("li",{parentName:"ul"},"Any fields in ",(0,r.kt)("inlineCode",{parentName:"li"},"vite.config.js")," are updated")),(0,r.kt)("p",null,"You can force Vite to re-bundle dependencies by completing one of the following tasks:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start the dev server with the ",(0,r.kt)("inlineCode",{parentName:"li"},"--force")," command line option"),(0,r.kt)("li",{parentName:"ul"},"Manually delete the ",(0,r.kt)("inlineCode",{parentName:"li"},"node_modules/.vite")," cache directory")),(0,r.kt)("h3",{id:"bundling-third-party-dependencies"},"Bundling third-party dependencies"),(0,r.kt)("p",null,"When bundling third-party dependencies, you might see errors in development or production related to the incorrect bundle type being used from the package."),(0,r.kt)("p",null,"This happens because ",(0,r.kt)("a",{parentName:"p",href:"https://vitejs.dev/"},"Vite")," uses a heuristic to determine whether to load a module-based import (ESM) or a CommonJS-based import (CJS). Sometimes, the heuristic chooses the wrong version, or the third-party package formats their project in an unusual way."),(0,r.kt)("p",null,"To fix this, you can try adding the dependency to the ",(0,r.kt)("inlineCode",{parentName:"p"},"optimizeDeps.include")," property of your ",(0,r.kt)("inlineCode",{parentName:"p"},"vite.config.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// vite.config.js\n\nimport {defineConfig} from 'vite';\nimport hydrogen from '@shopify/hydrogen/plugin';\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [hydrogen()],\n\n  optimizeDeps: {\n    include: ['YOUR_DEPENDENCY'],\n  },\n});\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Tip:\nIf you find that a dependency is being optimized when it shouldn't, then you can try adding the dependency to ",(0,r.kt)("inlineCode",{parentName:"p"},"optimizeDeps.exclude")," to see if it fixes the issue.")),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Learn more about dependency pre-bundling and optimization in ",(0,r.kt)("a",{parentName:"li",href:"https://vitejs.dev/guide/dep-pre-bundling.html#dependency-pre-bundling"},"Vite"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/Shopify/hydrogen/discussions/93"},"Check the Hydrogen GitHub discussion")," for your issue, or report a new issue to Hydrogen maintainers.")))}u.isMDXComponent=!0}}]);